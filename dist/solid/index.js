"use strict";var t=require("elum-state/solid"),e=require("@vkontakte/vk-bridge"),r=require("solid-js/store"),o=require("solid-js");const a=(t,e,r=[])=>{if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){if(t.constructor!==e.constructor)return!1;var o,s,n;if(Array.isArray(t)){if((o=t.length)!=e.length)return!1;for(s=o;0!=s--;)if(!a(t[s],e[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if((o=(n=Object.keys(t)).length)!==Object.keys(e).length)return!1;for(s=o;0!=s--;){var p=n[s];if(!r.includes(p)){if(!Object.prototype.hasOwnProperty.call(e,p))return!1;if(!a(t[p],e[p]))return!1}}return!0}return t!=t&&e!=e},s={panel:"default",modal:void 0,popout:void 0,stay:!1,freeze:!1,params:{}},n={},p=t.atom({key:"router_active_app"}),i=t.atom({key:"router_active_view"}),l=t.atom({key:"router_active_panel"}),c=t.atom({key:"router_active_modal"}),u=t.atom({key:"router_active_popout"}),f=t.atom({key:"router_active_notify"}),y=t.atom({key:"router_active_params"}),m=t.atom({key:"router_active_callback"}),g=["popout","modal","panel"],d=(r={ignoreFreeze:!1,toStay:!1})=>{"file:"!==window.location.protocol&&window.history.pushState(null,"");const o=t.getter(p),a=t.getter(i),s=n[o][a],f=((t,e)=>{const r=typeof t;if("boolean"===r&&!t)return e.length-2;const o="boolean"===r?Boolean:String;for(let r=e.length-1;r>0;r--)if(o(e[r].stay)===t)return r;return 0})(r.toStay||!1,s);if(1===s.length)return void e.send("VKWebAppClose",{status:"success"});const m=s.at(-1);m&&m.freeze&&!r.ignoreFreeze||(n[o].__snapshot=[{view:a,...s[f]}],t.setter(p,o),t.setter(i,a),t.setter(l,s[f].panel),t.setter(c,s[f].modal),t.setter(u,s[f].popout),t.setter(y,s[f].params),s.splice(f+1))},_=(e,r)=>{n[e]||(n[e]={__snapshot:[Object.assign(s,r)]});const o=n[e].__snapshot[0];t.setter(p,e),t.setter(i,o.view||r.view),t.setter(l,o.panel||r.panel),t.setter(c,o.modal||r.modal),t.setter(u,o.popout||r.popout),t.setter(y,o.params||r.params)};const v={view:i,panel:l,modal:c,popout:u};exports.ACTIVE_APP=p,exports.ACTIVE_MODAL=c,exports.ACTIVE_NOTIFY=f,exports.ACTIVE_PANEL=l,exports.ACTIVE_PARAMS=y,exports.ACTIVE_POPOUT=u,exports.ACTIVE_VIEW=i,exports.Router=e=>(t.getter(p)&&t.getter(i)||_(e.app||"app",{view:e.branch}),o.onMount((()=>{window.addEventListener("popstate",(()=>d())),"file:"!==window.location.protocol&&window.history.pushState(void 0,"")})),e.children),exports.backPage=d,exports.callback=e=>{const r=t.getter(m);r?.c&&"function"==typeof r?.c?r.c(e):console.warn("There is no function for callback")},exports.getNotify=()=>{const[e]=t.globalSignal(f),r=e();return r?{type:r.type,params:r.params}:{type:void 0,params:{}}},exports.getParams=()=>{const[e]=r.createStore(t.getter(y));return e},exports.getRouter=e=>{const[r]=t.globalSignal(v[e]);return r},exports.hideNotify=function(e){try{const r=t.getter(f);return(!e||r.type===e)&&(t.setter(f,void 0),r.callback({type:r.type,params:r.params}),!0)}catch{return!1}},exports.nextPage=(e,r)=>{"file:"!==window.location.protocol&&window.history.pushState(null,"");const o=t.getter(p),f=e.view||t.getter(i);n[o]||(n[o]={__snapshot:[]}),n[o][f]||(n[o][f]=[s]);const d=n[o][f].length,_=n[o][f][d-1],v={view:f,panel:e.panel||_.panel,modal:e.modal||_.modal,popout:e.popout||_.popout,stay:e.stay||s.stay,freeze:e.freeze||s.freeze,params:e.params||_.params};for(let t of g){if(e[t])break;v[t]=s[t]}a(_,v)||n[o][f].push(v),n[o].__snapshot=[v],t.setter(p,o),t.setter(i,f),t.setter(l,v.panel),t.setter(c,v.modal),t.setter(u,v.popout),t.setter(y,v.params),t.setter(m,{c:r}),e.clear&&f!=f&&(n[o].__snapshot=[s],n[o][f]=[s])},exports.showNotify=function(e,r,o,a){return a?function(e,r,o,a){const s=()=>(t.setter(f,void 0),a);t.setter(f,{type:e,params:o,callback:s}),r&&setTimeout((()=>{s()({type:e,params:o})}),r)}(e,r,o,a):function(e,r,o){return new Promise((a=>{const s=()=>(t.setter(f,void 0),a);t.setter(f,{type:e,params:o,callback:s}),r&&setTimeout((()=>{s()({type:e,params:o})}),r)}))}(e,r,o)},exports.swapApp=_;
