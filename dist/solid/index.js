"use strict";var t=require("elum-state/solid"),e=require("@vkontakte/vk-bridge"),r=require("solid-js/store"),o=require("solid-js");const a=(t,e,r=[])=>{if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){if(t.constructor!==e.constructor)return!1;var o,s,p;if(Array.isArray(t)){if((o=t.length)!=e.length)return!1;for(s=o;0!=s--;)if(!a(t[s],e[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if((o=(p=Object.keys(t)).length)!==Object.keys(e).length)return!1;for(s=o;0!=s--;){var n=p[s];if(!r.includes(n)){if(!Object.prototype.hasOwnProperty.call(e,n))return!1;if(!a(t[n],e[n]))return!1}}return!0}return t!=t&&e!=e},s={panel:"default",modal:void 0,popout:void 0,stay:!1,freeze:!1,params:{}},p={},n=t.atom({key:"router_active_app"}),i=t.atom({key:"router_active_view"}),u=t.atom({key:"router_active_panel"}),l=t.atom({key:"router_active_modal"}),c=t.atom({key:"router_active_popout"}),f=t.atom({key:"router_active_notify"}),y=t.atom({key:"router_active_params"}),m=["popout","modal","panel"],d=(r={ignoreFreeze:!1,toStay:!1})=>{"file:"!==window.location.protocol&&window.history.pushState(null,"");const o=t.getter(n),a=t.getter(i),s=p[o][a],f=((t,e)=>{const r=typeof t;if("boolean"===r&&!t)return e.length-2;const o="boolean"===r?Boolean:String;for(let r=e.length-1;r>0;r--)if(o(e[r].stay)===t)return r;return 0})(r.toStay||!1,s);if(1===s.length)return void e.send("VKWebAppClose",{status:"success"});const m=s.at(-1);m&&m.freeze&&!r.ignoreFreeze||(p[o].__snapshot=[{view:a,...s[f]}],t.setter(n,o),t.setter(i,a),t.setter(u,s[f].panel),t.setter(l,s[f].modal),t.setter(c,s[f].popout),t.setter(y,s[f].params),s.splice(f+1))},g=(e,r)=>{p[e]||(p[e]={__snapshot:[Object.assign(s,r)]});const o=p[e].__snapshot[0];t.setter(n,e),t.setter(i,o.view||r.view),t.setter(u,o.panel||r.panel),t.setter(l,o.modal||r.modal),t.setter(c,o.popout||r.popout),t.setter(y,o.params||r.params)};const v={view:i,panel:u,modal:l,popout:c};exports.ACTIVE_APP=n,exports.ACTIVE_MODAL=l,exports.ACTIVE_NOTIFY=f,exports.ACTIVE_PANEL=u,exports.ACTIVE_PARAMS=y,exports.ACTIVE_POPOUT=c,exports.ACTIVE_VIEW=i,exports.Router=e=>(t.getter(n)&&t.getter(i)||g(e.app||"app",{view:e.branch}),o.onMount((()=>{window.addEventListener("popstate",(()=>d())),"file:"!==window.location.protocol&&window.history.pushState(void 0,"")})),e.children),exports.backPage=d,exports.hideNotify=function(e){try{const r=t.getter(f);return(!e||r.type===e)&&(t.setter(f,void 0),r.callback({type:r.type,params:r.params}),!0)}catch{return!1}},exports.nextPage=e=>{"file:"!==window.location.protocol&&window.history.pushState(null,"");const r=t.getter(n),o=e.view||t.getter(i);p[r]||(p[r]={__snapshot:[]}),p[r][o]||(p[r][o]=[s]);const f=p[r][o].length,d=p[r][o][f-1],g={view:o,panel:e.panel||d.panel,modal:e.modal||d.modal,popout:e.popout||d.popout,stay:e.stay||s.stay,freeze:e.freeze||s.freeze,params:e.params||d.params};for(let t of m){if(e[t])break;g[t]=s[t]}a(d,g)||p[r][o].push(g),p[r].__snapshot=[g],t.setter(n,r),t.setter(i,o),t.setter(u,g.panel),t.setter(l,g.modal),t.setter(c,g.popout),t.setter(y,g.params),e.clear&&o!=o&&(p[r].__snapshot=[s],p[r][o]=[s])},exports.showNotify=function(e,r,o,a){return a?function(e,r,o,a){const s=()=>(t.setter(f,void 0),a);t.setter(f,{type:e,params:o,callback:s}),r&&setTimeout((()=>{s()({type:e,params:o})}),r)}(e,r,o,a):function(e,r,o){return new Promise((a=>{const s=()=>(t.setter(f,void 0),a);t.setter(f,{type:e,params:o,callback:s}),r&&setTimeout((()=>{s()({type:e,params:o})}),r)}))}(e,r,o)},exports.swapApp=g,exports.useNotify=()=>{const[e]=t.globalSignal(f),r=e();return r?{type:r.type,params:r.params}:{type:void 0,params:{}}},exports.useParams=()=>{const[e]=r.createStore(t.getter(y));return e},exports.useRouter=e=>{const[r]=t.globalSignal(v[e]);return r};
